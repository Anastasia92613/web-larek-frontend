# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Ключевые типы данных
```
 type UUID = string - определение id
 type PaymentMethod = 'online' | 'cash' | ''  - выбор вида оплаты, первоначальное состояние - не выбран.
 export type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'; - типы запросов. 
```

### Данные товара
```
  interface IProduct {
  id: UUID;  // id товара
  title: string; // наименование товара
  category: string; // категория товара
  description: string; // описание товара
  image: string; // изображение на карточке товара
  price: number | null; // стоимость товара
}
```

### Интерфейс описывающий католог товаров
```
interface ICatalogData {
  cards: IProduct[]; // переменная для хранения продуктов в каталоге
  preview: string | null; // переменная для хранения id карточки товара
  getCard (id: UUID): IProduct; // получение id карточки
};
```
### Интерфейс описывающий представление каталога товаров
```
interface IGallery {
  catalog: HTMLElement[];
};
```
### Тип данных товара для отображения в корзине
```
 type ICard = Pick<IProduct, 'id' | 'title' | 'price'>
 ```

### Данные покупателя
```
interface IBuyer {
  payment: PaymentMethod; // выбранный способ оплаты
  email: string; // электронная почта покупателя
  phone: string; // номер телефона покупателя
  address: string; // адресс покупателя
}
```

### Интерфейс описывающий формы
```
interface IForm {
  valid: boolean; //маркер валидности формы
  inputValues: Record<string, string>; // значение введенные в инпут/ы
  getInputValues(): Record<string, string>; //метод для получения значений, введенных в инпут/ы
  setError(fieldName: keyof IBuyer): void; //метод отображения текста ошибки
  clearError(): void; //метод очищения текста ошибок
  toggleActiveSubmit(disabled: boolean): void; // метод устанавливающий доступно кнопки
  reset(): void; //метод очистки формы
}
```
### Интерфейс описывающий корзину товаров
```
interface IBasket {
  products: IProduct[];
};
```
### Интерфейс количество товаров в корзине
```
interface IHeader {
  count: string;
};
```

### Тип данных для формы оформления заказа
```
type IDeliveryDetails = Pick<IBuyer, 'payment'| 'address'>;
```
### Тип данных для формы заполнения контактов
```
type IContactBuyer = Pick<IBuyer, 'phone'| 'email'>;
```
### Интерфейс, описывающий данные покупателя
```
interface IBuyerData {
    getBuyer(): IBuyer; // получение данных покупателя
    setDeliveryDetails(details: IDeliveryDetails): void; //сохранение типа оплаты и адреса
    setContact(contact: IContactBuyer): void; //сохранение контактных данных
};
```
### Интерфейс, данные заказа
```
interface IOrder {
  payment: PaymentMethod; //тип оплаты
  email: string; //электронная почта
  phone: string; //номер телефона
  address: string; //адрес
  total: number; // итоговая сумма заказа
  items: UUID[]; //id выбранных товаров
};
```
### Интерфейс, описывающий попап об успешном заказе
```
interface IOrderSuccess {
  modalContent: HTMLElement; //контент успешного заказа
  successDescription: HTMLElement; //элемент для указания суммы заказа
};
```

### Интерфейс, описывающий Api
```
interface IApi {
  baseUrl: string; // переменная для сохранения url запроса
  get<T>(uri: string): Promise<T>; //метод для получения данных
  post<T>(uri: string, data: object, method: ApiPostMethods): Promise<T>;// метод отправки данных на сервер
};
```
### Интерфейс, описывающий ответ от Api
```
type ApiListResponse<Type> = {
    total: number, // количество продуктов в массиве
    items: Type[] //массив продуктов
};
```

## Об архитектуре 

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.

## Архитектура приложения

Код приложения разделен на слои, согласно парадигме MVP:
* слой представления, отвечает за отображение данных на странице;
* слой данных, отвечает за хранение и изменение данных;
* презентер, отвечает за связь представления и данных.

## Базовый код

### Класс Api
Класс для выполнения HTTP-запросов к серверу. Реализует интерфейс IApi и предоставляет базовые методы для работы с REST API. 

 В полях хранятся следующие данные:
 - `readonly baseUrl: string` - базовый URL API для всех запросов;
 - `protected options: RequestInit` - настройки запроса по умолчанию, включая заголовки. 

Конструктор:
- `constructor(baseUrl: string, options: RequestInit = {})` - создает экземпляр API клиента, принимая базовый URL и опциональные настройки запроса. Автоматически устанавливает заголовок 'Content-Type': 'application/json'

Имеет методы: 
- `protected handleResponse<T>(response: Response): Promise<T>` - обрабатывает ответ сервера: возвращает JSON при успешном запросе или отклоняет промис с ошибкой при неудачном;
- `get<T>(uri: string): Promise<T>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post<T>(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<T>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### Класс Component
Класс для создания компонентов пользовательского интерфейса. Инкапсулирует общую логику работы с DOM-элементами, предоставляя интерфейс для управления отображением и состоянием компонентов. 

 В полях хранятся следующие данные: 
 - `protected readonly container: HTMLElement` - корневой DOM-элемент компонента, который служит контейнером для всего содержимого. 

 Конструктор:
 - `protected constructor(container: HTMLElement)` - создает экземпляр компонента, принимая корневой DOM-элемент.

Имеет методы:
- `toggleClass(element: HTMLElement, className: string, force?: boolean): void` - переключает CSS-класс на элементе с возможностью принудительного установления состояния. Принимает эелемент, название класса и булево значение для принудительной установки состояния. Метод ничего не возвращает;
- `protected setText(element: HTMLElement, value: unknown): void ` - устанавливает текстовое содержимое элемента. Принимает в себя элемени и его значение, которое нужно установить. Метод ничего не возвращает:
- `setDisabled(element: HTMLElement, state: boolean): void` - метод для управления блокировкой кнопки. Принимает в себя элемент кнопки и ее состояние. Метод ничего не возвращает;
- `setHidden(element: HTMLElement): void` - скрывает элемент через display: none. Принимает элемент, который необходимо скрыть. Метод ничего не возвращает;
- `setVisible(element: HTMLElement): void` - показывает элемент, убирая свойство display. Принимает элемент, который необходимо показать. Метод ничего не возвращает;
- `setImage(element: HTMLImageElement, src: string, alt?: string): void` - метод для установки изображения в интерфейс. Принимает элемент для установки изображения, атрибуты `src` и `alt`. Метод ничего не возвращает;
- `render(data?: Partial<T>): HTMLElement` - обновляет состояние компонента на основе переданных данных и возвращает корневой DOM-элемент. Принимает в себя данные, необходимые для отображения и возвращает элемент разметки;

### Класс ApiApp
Класс-фасад для работы с API приложения. Инкапсулирует все HTTP-запросы к серверу, предоставляя удобный интерфейс для работы с товарами и заказами.

 В полях хранятся следующие данные: 
 - `_baseApi: IAp` - базовый API клиент для выполнения HTTP-запросов.

 Конструктор:
 - `constructor(api: IApi)` - создает экземпляр API фасада, принимая базовый API клиент для выполнения запросов.

Имеет методы:
- `getCards(): Promise<IProduct[]>` - получает список всех товаров из каталога;
- `getCard(id: UUID): Promise<IProduct>` - получает детальную информацию о конкретном товаре по его `id`;
- `postOrder(order: IOrder): Promise<{ id: string, total: number}>` - отправляет заказ на сервер и возвращает информацию о созданном заказе. 

### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.    

## Слой данных

### Класс CatalogData 
Класс для управления данными каталога товаров. Реализует интерфейс ICatalogData и обеспечивает хранение, обновление и предоставление информации о товарах в каталоге, включая работу с предпросмотром товаров.

В полях хранятся следующие данные:  

- `_cards: IProduct[]` - массив товаров в каталоге;
- `_preview: UUID | null` - `id` карточки, выбранной для просмотра в модальном окне;
- `events: IEvents` - события для работы с классом. 

Конструктор:
- `constructor(events: IEvents)` - создает экземпляр каталога товаров и инициализирует события класса.

Имеет методы:

- `setCards (cards: IProduct[]): void` - устанавливает массив товаров в каталог и уведомляет об изменениях. Принимает в себя массиво товаров. Метод ничего не возвращает;   
- `get cards (): IProduct[]` - возвращает массив всех товаров в каталоге;  
- `setPreview(id: UUID | null): void` -  устанавливает товар для предпросмотра по его `id`. Метод ничего не возвращает;
- `get preview (): UUID | null` - возвращает `id` товара, выбранного для предпросмотра;
- `getCard(id: UUID): IProduct` - находит и возвращает товар по его `id`.

### Класс BasketData
Класс для управления корзиной покупок. Реализует интерфейс IBasket и обеспечивает хранение, обновление и управление товарами в корзине, включая добавление, удаление и расчет общей стоимости.

В полях хранятся следующие данные:  
- `_products: IProduct[] | null = []` - массив товаров в корзине;
- `events: IEvents` - события для работы с классом. 

Конструктор:
- `constructor(events: IEvents` - создает экземпляр корзины покупок и инициализирует события класса.

 Имеет методы:

- `setProduct( product: IProduct): void` - добавляет товар в корзину, если его еще нет;  
- `get products (): IProduct[] | null` - возвращает массив товаров в корзине. Может иметь значение null;  
- `isProductInBasket (id: UUID): boolean` - проверяет, находится ли товар с указанным ID в корзине. Возвращает булевое значение;  
- `deleteProduct (id: UUID): void` - удаляет товар из корзины по ID. Метод ничего не возвращает;    
- `resetBasket(): void` - полностью очищает корзину. Метод ничего не возвращает;
- `getCountProductsInBascket (): number` - возвращает количество товаров в корзине;  
- `getTotalSumProducts (): number` - вычисляет общую стоимость товаров в корзине.  


### Класс BuyerData
Класс для управления данными покупателя. Реализует интерфейс IBuyerData и обеспечивает хранение, обновление и предоставление информации о покупателе, включая контактные данные и детали доставки.

В полях хранятся следующие данные:  
- `payment: PaymentMethod` - выбранный способ оплаты;
- `email: string` - электронная почта; 
- `phone: string` - номер телефона;
- `address: string;` - адресс доставки;
- `events: IEvents` - события для работы с классом. 

Конструктор:
- `constructor(events: IEvents)` - создает экземпляр данных покупателя и инициализирует события класса.

Имеет методы:

- `getBuyer (): IBuyer` - возвращает полный объект с данными покупателя;  
- `setDeliveryDetails (details: IDeliveryDetails): void` - устанавливает данные доставки и способ оплаты. Метод ничего не возвращает;  
- `setContact (contact: IContactBuyer): void` - сохранение контактных данных;
- `resetBuyer (): void` -  очищает данные покупателя. Метод ничего не возвращает. 

## Слой представления

### Класс Card
Класс для отображения карточки товара. Предоставляет основную функциональность для работы с карточками продуктов, включая отображение названия, цены и уникального идентификатора

Содержит в себе следующие элементы карточки:
- `title: HTMLElement` - элемент для отображения названия товара;
- `price: HTMLElement` - элемент для отображения стоимости товара; 
- `_id: UUID` - id товара;
- `events: IEvents` - события для работы с классом. 

Конструктор:
- `constructor(template: HTMLTemplateElement, events: IEvents) ` - создает экземпляр карточки товара, клонирует HTML шаблон и находит элемент наименования и стоимости товара внутри контейнера.

Имеет методы:

- `get id():UUID ` - получение `id` товара. Возвращает `id` товара;  
- `formatPrice(price: number | null): string` - метод для определения формата отображения - на интерфейс может быть выведна стоимость, для товара без цены будет выведен текст. Принимает стоимосто товара типа `number` или `null`. Возвращает текстовое значение стоимости или строку, заменяющую `null`;  
- `render (data:  IProduct): HTMLElement` - общий метод рендера карточки. Принимает в себя данные товара и возвращает элемент разметки карточки.   

### Класс Form
Общий класс для работы с HTML формами. Обеспечивает валидацию, управление состоянием и обработку событий форм.

Содержит в себе следующие элементы формы:
- `formElement: HTMLFormElement` - элемент формы;
- `formName: string` - название формы; 
- `error: HTMLElement` - элемент для отображения ошибок;
- `inputs: HTMLInputElement[]` - массив input элементов формы;
- `submitButton: HTMLButtonElement` - кнопка отправки формы;
- `events: IEvents` - события для работы с классом. 

Конструктор:
- `constructor(container: HTMLTemplateElement, events: IEvents)` - создает экземпляр формы, находит элемент инпута, наименование формы по атрибуту name, поле для отображения сообщения об ошибке, кнопку отправки формы и устанавливает обработчики событий отправки формы и ввода текста в инпут.

Имеет методы:

- `setError(fieldName: keyof IBuyer): void` - отображает сообщение об ошибке для указанного поля. Принимает наименованипе инпута, которая совподает с ключами интерфейса `IBuyer`. Метод ничего не возвращает;  
- `clearError(): void` - очищает сообщение об ошибке. Метод ничего не возвращает;  
- `getInputValues(): Record<string, string>` - возвращает объект со значениями всех полей формы, где первое значение наименование инпута, а второе его значение;  
- `toggleActiveSubmit(value: boolean): void` - активирует или деактивирует кнопку отправки формы. Принимает булевое значение для деактивации. Метод ничего не возвращает; 
- `get form(): HTMLFormElement` - возвращает элемент формы для внешнего использования; 
- `reset(): void` - сбрасывает значения формы и очищает ошибки. Метод ничего не возвращает.  


### Класс Modal
Универсальный класс для управления модальными окнами. Обеспечивает открытие, закрытие и управление содержимым модальных окон.

Содержит в себе следующие элементы модального окна:

- `modalContent: HTMLElement` - контейнер для содержимого модального окна;
- `closeButton: HTMLButtonElement` - кнопка закрытия модального окна;
- `events: IEvents` - события для работы с классом.  

Конструктор:
- `constructor(container: HTMLElement, events: IEvents)` - создает экземпляр модального окна, находит элемент контейнера модальной карточки, кнопку закрытия модальной карточки и устанавливает обработчики событий для закрытия модального окна.

Имеет методы:

- `open(): void` - открывает модальное окно. Метод ничего не возвращает;
- `close(): void` - закрывает модальное окно. Метод ничего не возвращает;
- `setContent(item: HTMLElement): void` - устанавливает содержимое модального окна и автоматически открывает его. Принимает в себя элемент с контентом модального окна. Метод ничего не возвращает;
- `handleEscUp(evt: KeyboardEvent): void` - обработчик нажатия клавиши Escape для закрытия модального окна. Принимает в себя событие нажатия клавиши. Метод ничего не возвращает. 


### Класс CardBasket
Класс для отображения товаров в корзине. Наследует базовый функционал класса Card и добавляет возможности управления позициями в корзине.

Содержит в себе следующие элементы:

 - `itemIndex: HTMLElement` - элемент для отображения порядкового номера товара в корзине;
 - `productDelete: HTMLButtonElement` - кнопка удаления товара из корзины.

 Конструктор:
 - `constructor(template: HTMLTemplateElement, events: IEvents)` - создает экземпляр карточки корзины, находит элемент порядкового номера товара в корзине, а также кнопку удаления товара из корзины, и устанавливает обработчики событий для удаления товара.

 Имеет методы:

 - `render(data: IProduct, index?: string): HTMLElement` - отображает данные товара в корзине, включая порядковый номер позиции. Принимает в себя данные товара и его порядковый номер в корзине. Возвращает элемент товара в корзине;

 Наследует все методы базового класса Card - отображение названия, цены и другой информации о товаре.


### Класс CardCatalog
Класс для отображения товаров в каталоге. Наследует базовый функционал класса Card и добавляет возможности отображения дополнительной информации и взаимодействия с товарами в каталоге.

Содержит в себе следующие элементы:

- `image: HTMLImageElement` - элемент для отображения изображения товара;
- `buttonCard: HTMLButtonElement` - интерактивная область карточки, открытие подробной информации о товаре;
- `category: HTMLElement` - элемент для отображения категории товара.

Конструктор:
- `constructor(template: HTMLTemplateElement, events: IEvents)` - создает экземпляр карточки каталога, находит элементы для отображения изображения товара, сатегории товара и элемент карточки, как кликабельную кнопку и устанавливает обработчик событий для открытия детальной информации о товаре.

Имеет методы:

- `render(data: IProduct): HTMLElement` - отображает полную информацию о товаре в каталоге, включая изображение и категорию. Принимает в себя данные товара и возвращает элемент карточки из каталога;

Наследует все методы базового класса Card - отображение названия, цены и другой базовой информации о товаре.

### Класс CardFull
Класс для отображения полной информации о товаре. Наследует базовый функционал класса Card и добавляет возможности отображения детальной информации, описания и управления состоянием кнопки покупки.

Содержит в себе следующие элементы:
- `image: HTMLImageElement` - элемент для отображения изображения товара;
- `description: HTMLElement` - элемент для отображения подробного описания товара;  
- `cardButton: HTMLButtonElement` - кнопка управления товаром (добавление/удаление из корзины);
- `category: HTMLElement` -  элемент для отображения категории товара;
- `template: HTMLTemplateElement` - шаблон карточки;

Конструктор:
- `constructor(template: HTMLTemplateElement, events: IEvents)` - создает экземпляр карточки с полной информацией, находит для отображения элемент для отображения картинки, подробного описания, кнопку для добавления/удаления товара в корзине, категорию товара и устанавливает обработчик события для добавления/удаления товара в корзине.

Имеет методы:

- `toggleButtonView(value: boolean, price: number | null): void` - управляет состоянием и текстом кнопки в зависимости от наличия цены товара. Принимает в себя булевое состояние блокировки кнопки, стоимость товара, которая может иметь значение `null` или `number`;
- `render(data: IProduct, stateButton?: boolean): HTMLElement` - отображает полную информацию о товаре, включая изображение, описание и актуальное состояние кнопки. Принимает данные карточки, состояние кнопки и возвращает элемент детальной карточки. 


Наследует все методы базового класса Card - отображение названия, цены и другой базовой информации.

### Класс FormOrder
Класс формы для оформления заказа. Наследует базовый функционал класса Form и добавляет возможности выбора способа оплаты и управления состоянием кнопок выбора оплаты.

Содержит в себе следующие элементы:
- `_payment: string` - выбранный способ оплаты;
- `buttonOnline: HTMLButtonElement` - кнопка выбора онлайн-оплаты;
- `buttonOffline: HTMLButtonElement` - кнопка выбора оплаты при получении.

Конструктор:
- `constructor(container: HTMLTemplateElement, events: IEvents)` - создает экземпляр формы заказа, находит кнопки выбора способа оплаты и устанавливает обработчики событий для управления способом оплаты.

Имеет методы:

- `handlePaymentClick(evt: Event): void` - внутренний метод, обрабатывает клик по кнопкам выбора способа оплаты. Принимает в себя событие клика. Метод ничего не возвращает;
- `toggleButton(button: string): void` - внутренний метод, управляет визуальным состоянием кнопок оплаты. Принимает в себя атрибут name кнопки, по которому определяет выбранный тип оплаты. Метод ничего не возвращает;
- `get payment(): string` - возвращает выбранный способ оплаты строкой;

Наследует все методы базового класса Form - валидация, управление состоянием, получение значений полей.

### Класс Gallery
Kласс для управления галереей товаров. Предназначен для отображения и управления коллекцией карточек товаров в виде галереи.

Содержит в себе следующие элементы:
- `container: HTMLElement` - контейнер для отображения карточек товаров.

Конструктор:
- `constructor(container: HTMLElement)` - создает экземпляр галереи, принимает контейнер для размещения карточек товаров.

Имеет методы:

- `set catalog(items: HTMLElement[]): void` - обновляет содержимое галереи, заменяя все текущие элементы на переданный массив карточек товаров.
Принимает в себя элемент со списком товаров. Метод ничего не возвращает. 

### Класс Header
Класс для управления шапкой приложения. Отвечает за отображение состояния корзины покупок и предоставляет доступ к функционалу корзины через интерфейс.

Содержит в себе следующие элементы:
- `countElement: HTMLElement` - элемент для отображения количества товаров в корзине;
- `basketButton: HTMLButtonElement` - кнопка для открытия корзины покупок;
- `container: HTMLElement` - контейнер шапки приложения;
- `events: IEvents` - события для работы с классом.  

Конструктор:
- `constructor(container: HTMLElement, events: IEvents)` - создает экземпляр шапки, находит элемент корзины и элемент для отображения количества товаров в корзине, и устанавливает обработчики событий для работы с корзиной.
Принимает контейнер с шапкой приложения и события для работы с классом. 

Имеет методы:

- `set count(count: string): void` - обновляет отображение количества товаров в корзине. 
Принимает строку с количеством товаров в корзине. Метод ничего не возвращает. 

### Класс ModalBasket
Класс модального окна для отображения и управления корзиной покупок. Наследует базовый функционал класса Modal и добавляет возможности работы с элементами корзины.

Содержит в себе следующие элементы:
- `basketList: HTMLElement` - контейнер для списка товаров в корзине;
- `basketTotal: HTMLElement` - basketTotal: HTMLElement;
- `buttonOrder: HTMLElement` -  кнопка оформления заказа.

Конструктор:
- `constructor(container: HTMLElement, events: IEvents)` - создает экземпляр модального окна корзины, находит элементы для отображения списка товаров в корзине, итоговой суммы заказа и кнопки оформления заказа. Устанавливает обработчики событий для оформления заказа.
Принимает в себя элемент со списком товаров в корзине и события для работы с классом. 

Имеет методы:

- `setList(items: HTMLElement[], total: string): void` - обновляет содержимое корзины, отображает переданные товары и общую сумму, затем открывает модальное окно. Принимает в себя массив из элементов списка товарова и итоговую сумму заказа. Метод ничего не возвращает. 

Наследует все методы базового класса Modal - открытие, закрытие, управление содержимым модального окна.

### Класс OrderSuccess
Класс модального окна для отображения успешного оформления заказа. Наследует базовый функционал класса Modal.

Содержит в себе следующие элементы:
- `successDescription: HTMLElement` - элемент для отображения информации о списанной сумме;
- `events: IEvents` - события для работы с классом. 

Конструктор:
- `constructor(container: HTMLElement, events: IEvents)` - создает экземпляр модального окна успешного заказа, находит элементы для отображения данных и дополнительного взаимодействия с пользователем(дополнительная кнопка закрытия модального окна), и устанавливает обработчики событий для закрытия окна.
Принимает в себя контейнер модального окна и события для работы с классом. 

Имеет методы:

- `setDescription(sum: string): void` - устанавливает описание с информацией о списанной сумме и автоматически открывает модальное окно.
Принимает строку с указанем суммы. Метод ничего не возвращает. 

Наследует все методы базового класса Modal - открытие, закрытие, управление содержимым модального окна.
