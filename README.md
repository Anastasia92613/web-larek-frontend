# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Ключевые типы данных
```
 type UUID = string - определение id
 type PaymentMethod = 'online' | 'cash' | ''  - выбор вида оплаты, первоначальное состояние - не выбран.
 export type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'; - типы запросов. 
```

### Данные товара
```
  interface IProduct {
  id: UUID;  // id товара
  title: string; // наименование товара
  category: string; // категория товара
  description: string; // описание товара
  image: string; // изображение на карточке товара
  price: number | null; // стоимость товара
}
```

### Интерфейс описывающий католог товаров
```
interface ICatalogData {
  cards: IProduct[]; // переменная для хранения продуктов в каталоге
  preview: string | null; // переменная для хранения id карточки товара
  getCard (id: UUID): IProduct; // получение id карточки
};
```
### Интерфейс описывающий представление каталога товаров
```
interface IGallery {
  catalog: HTMLElement[];
};
```
### Тип данных товара для отображения в корзине
```
 type ICard = Pick<IProduct, 'id' | 'title' | 'price'>
 ```

### Данные покупателя
```
interface IBuyer {
  payment: PaymentMethod; // выбранный способ оплаты
  email: string; // электронная почта покупателя
  phone: string; // номер телефона покупателя
  address: string; // адресс покупателя
}
```

### Интерфейс описывающий формы
```
interface IForm {
  valid: boolean; //маркер валидности формы
  inputValues: Record<string, string>; // значение введенные в инпут/ы
  getInputValues(): Record<string, string>; //метод для получения значений, введенных в инпут/ы
  setError(fieldName: keyof IBuyer): void; //метод отображения текста ошибки
  clearError(): void; //метод очищения текста ошибок
  toggleActiveSubmit(disabled: boolean): void; // метод устанавливающий доступно кнопки
  reset(): void; //метод очистки формы
}
```
### Интерфейс описывающий корзину товаров
```
interface IBasket {
  products: IProduct[];
};
```
### Интерфейс количество товаров в корзине
```
interface IHeader {
  count: string;
};
```

### Тип данных для формы оформления заказа
```
type IDeliveryDetails = Pick<IBuyer, 'payment'| 'address'>;
```
### Тип данных для формы заполнения контактов
```
type IContactBuyer = Pick<IBuyer, 'phone'| 'email'>;
```
### Интерфейс, описывающий данные покупателя
```
interface IBuyerData {
    getBuyer(): IBuyer; // получение данных покупателя
    setDeliveryDetails(details: IDeliveryDetails): void; //сохранение типа оплаты и адреса
    setContact(contact: IContactBuyer): void; //сохранение контактных данных
};
```
### Интерфейс, данные заказа
```
interface IOrder {
  payment: PaymentMethod; //тип оплаты
  email: string; //электронная почта
  phone: string; //номер телефона
  address: string; //адрес
  total: number; // итоговая сумма заказа
  items: UUID[]; //id выбранных товаров
};
```
### Интерфейс, описывающий попап об успешном заказе
```
interface IOrderSuccess {
  modalContent: HTMLElement; //контент успешного заказа
  successDescription: HTMLElement; //элемент для указания суммы заказа
};
```

### Интерфейс, описывающий Api
```
interface IApi {
  baseUrl: string; // переменная для сохранения url запроса
  get<T>(uri: string): Promise<T>; //метод для получения данных
  post<T>(uri: string, data: object, method: ApiPostMethods): Promise<T>;// метод отправки данных на сервер
};
```
### Интерфейс, описывающий ответ от Api
```
type ApiListResponse<Type> = {
    total: number, // количество продуктов в массиве
    items: Type[] //массив продуктов
};
```


## Архитектура приложения

Код приложения разделен на слои, согласно парадигме MVP:
* слой представления, отвечает за отображение данных на странице;
* слой данных, отвечает за хранение и изменение данных;
* презентер, отвечает за связь представления и данных.

## Базовый код

### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### Класс Component
Содержит базовую логику для работы с компонентами. 

Имеет методы:
- `toggleClass(element: HTMLElement, className: string, force?: boolean)` - метод управления функцией добавления или удаления класса с элемента;
- `protected setText(element: HTMLElement, value: unknown) ` - метод для сохранения текстового контента на элементе;
- `setDisabled(element: HTMLElement, state: boolean)` - метод для управления блокировкой кнопки;
- `setHidden(element: HTMLElement)` - метод для скрытия элемента интерфейса;
- `setVisible(element: HTMLElement)` - метод для отображения скрытого элемента интерфейса;
- `ssetImage(element: HTMLImageElement, src: string, alt?: string)` - метод для установки изображения в интерфейс;
- `render(data?: Partial<T>): HTMLElement` - метод для рендера элемента интерфейса;

### Класс ApiApp
Содержит в себе логику получения и отправки данных на сервер.  

Имеет методы:
- `getCards(): Promise<IProduct[]>` - получение данных по товарам;
- `getCard(id: UUID): Promise<IProduct>` - получение данных одной карточки;
- `postOrder(order: IOrder): Promise<{ id: string, total: number}>` - отправка заказа на сервер.  

### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.    

## Слой данных

### Класс CatalogData 
 Позволяет работать со списком товаров в каталоге. Так же содержит в себе выбранный для подробного отображения товар.
 

В полях хранятся следующие данные:  

- `_cards: IProduct[]` - массив товаров в каталоге;
- `_preview: UUID | null` - id карточки, выбранной для просмотра в модальном окне;
- `events: IEvents` - события для работы с классом. 


Имеет методы:

- `get cards (): IProduct[]` - получение всего списка товаров в каталоге;  
- `setCards (cards: IProduct[])` - добавление списка товаров в каталог;    
- `setPreview(id: UUID | null)` - сохранение id выбранной карточки товара в каталоге;
- `get preview (): UUID | null` - получение id выбранной карточки товара в каталоге;
- `getCard` - получение выбранного для подробного отображения товара.

### Класс BasketData

Позволяет работать с товарами, добавленными в корзину.

В полях хранятся следующие данные:  
- `_products: IProduct[] | null = []` - массив товаров в корзине;
- `events: IEvents` - события для работы с классом. 

 Имеет методы:

- `setProduct( product: IProduct)` - добавление товара в корзину;  
- `get products (): IProduct[] | null` - получение всех добавленных в товар корзину. Может иметь значение null;  
- `isProductInBasket (id: UUID): boolean` - проверка наличия товара в корзине;  
- `deleteProduct (id: UUID)` - удаление товара из корзины;    
- `getCountProductsInBascket (): number` - получение количества товаров в корзине;  
- `getTotalSumProducts (): number` - получение суммы всех заказов.  


### Класс BuyerData
Позволяет работать с данными покупателя.

В полях хранятся следующие данные:  
- `payment: PaymentMethod` - выбранный способ оплаты;
- `email: string` - электронная почта; 
- `phone: string` - номер телефона;
- `address: string;` - адресс доставки;
- `events: IEvents` - события для работы с классом. 

Имеет методы:

- `getBuyer (): IBuyer` - получение данных покупателя;  
- `setDeliveryDetails (details: IDeliveryDetails)` - сохранение данных по заказу;  
- `setContact (contact: IContactBuyer)` - сохранение контактных данных.  

## Слой представления

### Класс Card
Общий класс для отображения данных карточки продукта. 

Содержит в себе следующие элементы карточки:
- `title: HTMLElement` - наименование товара;
- `price: HTMLElement` - стоимость товара; 
- `_id: UUID` - id товара;
- `events: IEvents` - события для работы с классом. 

Имеет методы:

- `get id():UUID ` - получение id товара;  
- `formatPrice(price: number | null): string` - метод для определения формата отображения - на интерфейс может быть выведна стоимость, для товара без цены будет выведен текст;  
- `render (data:  IProduct): HTMLElement` - общий метод рендера карточки.  

### Класс Form
Общий класс для работы с HTML формами. Обеспечивает валидацию, управление состоянием и обработку событий форм.

Содержит в себе следующие элементы формы:
- `formElement: HTMLFormElement` - элемент формы;
- `formName: string` - название формы; 
- `error: HTMLElement` - элемент для отображения ошибок;
- `inputs: HTMLInputElement[]` - массив input элементов формы;
- `submitButton: HTMLButtonElement` - кнопка отправки формы;
- `events: IEvents` - события для работы с классом. 

Имеет методы:

- `setError(fieldName: keyof IBuyer): void` - отображает сообщение об ошибке для указанного поля;  
- `clearError(): void` - очищает сообщение об ошибке;  
- `getInputValues(): Record<string, string>` - возвращает объект со значениями всех полей формы;  
- `toggleActiveSubmit(value: boolean): void` - активирует или деактивирует кнопку отправки формы;  
- `reset(): void` - сбрасывает значения формы и очищает ошибки;
- `get form(): HTMLFormElement` - возвращает элемент формы для внешнего использования.

### Класс Modal
Универсальный класс для управления модальными окнами. Обеспечивает открытие, закрытие и управление содержимым модальных окон.

Содержит в себе следующие элементы модального окна:

- `modalContent: HTMLElement` - контейнер для содержимого модального окна;
- `closeButton: HTMLButtonElement` - кнопка закрытия модального окна;
- `events: IEvents` - события для работы с классом.  

Имеет методы:

- `open(): void` - открывает модальное окно;
- `close(): void` - закрывает модальное окно;
- `setContent(item: HTMLElement): void` - устанавливает содержимое модального окна и автоматически открывает его;
- `handleEscUp(evt: KeyboardEvent): void` - обработчик нажатия клавиши Escape для закрытия модального окна.


### Класс CardBasket
Класс для отображения товаров в корзине. Наследует базовый функционал класса Card и добавляет возможности управления позициями в корзине.

Содержит в себе следующие элементы:

 - `itemIndex: HTMLElement` - элемент для отображения порядкового номера товара в корзине;
 - `productDelete: HTMLButtonElement` - кнопка удаления товара из корзины.

 Имеет методы:

 - `render(data: IProduct, index?: string): HTMLElement` - отображает данные товара в корзине, включая порядковый номер позиции;

 Наследует все методы базового класса Card - отображение названия, цены и другой информации о товаре.


### Класс CardCatalog
Класс для отображения товаров в каталоге. Наследует базовый функционал класса Card и добавляет возможности отображения дополнительной информации и взаимодействия с товарами в каталоге.

Содержит в себе следующие элементы:

- `image: HTMLImageElement` - элемент для отображения изображения товара;
- `buttonCard: HTMLButtonElement` - интерактивная область карточки, открытие подробной информации о товаре;
- `category: HTMLElement` - элемент для отображения категории товара.

Имеет методы:

- `render(data: IProduct): HTMLElement` - отображает полную информацию о товаре в каталоге, включая изображение и категорию;

Наследует все методы базового класса Card - отображение названия, цены и другой базовой информации о товаре.

### Класс CardFull
Класс для отображения полной информации о товаре. Наследует базовый функционал класса Card и добавляет возможности отображения детальной информации, описания и управления состоянием кнопки покупки.

Содержит в себе следующие элементы:
- `image: HTMLImageElement` - элемент для отображения изображения товара;
- `description: HTMLElement` - элемент для отображения подробного описания товара;  
- `cardButton: HTMLButtonElement` - кнопка управления товаром (добавление/удаление из корзины);
- `category: HTMLElement` -  элемент для отображения категории товара;
- `template: HTMLTemplateElement` - шаблон карточки;

Имеет методы:

- `render(data: IProduct, stateButton?: boolean): HTMLElement` - отображает полную информацию о товаре, включая изображение, описание и актуальное состояние кнопки;
- `toggleButtonView(value: boolean, price: number | null): void` - управляет состоянием и текстом кнопки в зависимости от наличия цены товара;

Наследует все методы базового класса Card - отображение названия, цены и другой базовой информации.

### Класс FormOrder
Класс формы для оформления заказа. Наследует базовый функционал класса Form и добавляет возможности выбора способа оплаты и управления состоянием кнопок выбора оплаты.

Содержит в себе следующие элементы:
- `_payment: string` - выбранный способ оплаты;
- `buttonOnline: HTMLButtonElement` - кнопка выбора онлайн-оплаты;
- `buttonOffline: HTMLButtonElement` - кнопка выбора оплаты при получении.

Имеет методы:

- `handlePaymentClick(evt: Event): void` - обрабатывает клик по кнопкам выбора способа оплаты;
- `toggleButton(button: string): void` - управляет визуальным состоянием кнопок оплаты;
- `get payment(): string` - возвращает выбранный способ оплаты;

Наследует все методы базового класса Form - валидация, управление состоянием, получение значений полей.

### Класс Gallery
Kласс для управления галереей товаров. Предназначен для отображения и управления коллекцией карточек товаров в виде галереи.

Содержит в себе следующие элементы:
- `container: HTMLElement` - контейнер для отображения карточек товаров.

Имеет методы:

- `set catalog(items: HTMLElement[]): void` - обновляет содержимое галереи, заменяя все текущие элементы на переданный массив карточек товаров.

### Класс Header
Класс для управления шапкой приложения. Отвечает за отображение состояния корзины покупок и предоставляет доступ к функционалу корзины через интерфейс.

Содержит в себе следующие элементы:
- `countElement: HTMLElement` - элемент для отображения количества товаров в корзине;
- `basketButton: HTMLButtonElement` - кнопка для открытия корзины покупок;
- `container: HTMLElement` - контейнер шапки приложения;
- `events: IEvents` - события для работы с классом.  

Имеет методы:

- `set count(count: string): void` - обновляет отображение количества товаров в корзине.

### Класс ModalBasket
Класс модального окна для отображения и управления корзиной покупок. Наследует базовый функционал класса Modal и добавляет возможности работы с элементами корзины.

Содержит в себе следующие элементы:
- `basketList: HTMLElement` - контейнер для списка товаров в корзине;
- `basketTotal: HTMLElement` - basketTotal: HTMLElement;
- `buttonOrder: HTMLElement` -  кнопка оформления заказа.

Имеет методы:

- `setList(items: HTMLElement[], total: string): void` - обновляет содержимое корзины, отображает переданные товары и общую сумму, затем открывает модальное окно.

Наследует все методы базового класса Modal - открытие, закрытие, управление содержимым модального окна.

### Класс OrderSuccess
Класс модального окна для отображения успешного оформления заказа. Наследует базовый функционал класса Modal.

Содержит в себе следующие элементы:
- `successDescription: HTMLElement` - элемент для отображения информации о списанной сумме;
- `events: IEvents` - события для работы с классом. 

Имеет методы:

- `setDescription(sum: string): void` - устанавливает описание с информацией о списанной сумме и автоматически открывает модальное окно.

Наследует все методы базового класса Modal - открытие, закрытие, управление содержимым модального окна.
